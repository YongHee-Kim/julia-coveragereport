name: 'Julia test coverage report'
description: 'create and upload Julia test coverage report to Github pages'
author: 'YongHee Kim'

branding:
  icon: 'settings'
  color: 'gray-dark'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: julia-actions/julia-processcoverage@v1
      - name: Declare some variables
        id: vars
        shell: bash
        run: |
          echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
          echo "::set-output name=sha_short::$(git rev-parse --short HEAD)"

      - name: ReportGenerator
        uses: danielpalme/ReportGenerator-GitHub-Action@4.6.4
        with:
            reports: 'lcov.info' 
            targetdir: 'coverage/dev' # REQUIRED # The directory where the generated report should be saved.
            historydir: '' 
            reporttypes: 'HtmlInline;Badges' # The output formats and scope (separated by semicolon) Values: Badges, Clover, Cobertura, CsvSummary, Html, HtmlChart, HtmlInline, HtmlInline_AzurePipelines, HtmlInline_AzurePipelines_Dark, HtmlSummary, JsonSummary, Latex, LatexSummary, lcov, MHtml, PngChart, SonarQube, TeamCitySummary, TextSummary, Xml, XmlSummary
            verbosity: 'Info' # The verbosity level of the log messages. Values: Verbose, Info, Warning, Error, Off
      - name: Push Report
        uses: EndBug/add-and-commit@v4 # You can change this to use a specific version
        with:
          add: 'coverage/*'
          message: 'Coverage Report ${{ steps.vars.outputs.sha_short }}' # TODO: include Commit id
          ref: 'gh-pages' 
          remove: ''
